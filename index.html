<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <title>Smart Dashboard</title>
</head>
<body>
    <div id="background"></div>
    <div id="dashboard">
        <div id="version-number">v0.1.6</div>
        <div id="widget-container"></div>
    </div>
    <div id="chore-popup" class="popup">
        <div class="popup-content">
            <h2>Configure Chore Timing</h2>
            <p>Chore: <span id="chore-name"></span></p>
            <div class="day-selection">
                <label><input type="checkbox" class="day-checkbox" value="mon"><span>Mon</span></label>
                <label><input type="checkbox" class="day-checkbox" value="tue"><span>Tue</span></label>
                <label><input type="checkbox" class="day-checkbox" value="wed"><span>Wed</span></label>
                <label><input type="checkbox" class="day-checkbox" value="thu"><span>Thu</span></label>
                <label><input type="checkbox" class="day-checkbox" value="fri"><span>Fri</span></label>
                <label><input type="checkbox" class="day-checkbox" value="sat"><span>Sat</span></label>
                <label><input type="checkbox" class="day-checkbox" value="sun"><span>Sun</span></label>
                <button id="select-all-days-button">All Days</button>
            </div>
            <div class="time-selection">
                <label for="chore-time">Time 1:</label>
                <input type="time" id="chore-time">
            </div>
            <div class="time-selection">
                <label for="chore-time2">Time 2 (Optional):</label>
                <input type="time" id="chore-time2">
            </div>
            <button id="save-chore-button">Save</button>
            <button id="close-popup-button">Close</button>
        </div>
    </div>
    
    <!-- Debug toggle button -->
    <div id="debug-toggle" class="debug-control">
        <button onclick="window.toggleDebugging()">Debug</button>
    </div>

    <!-- Debug timer displays -->
    <div id="main-widget-debug-timer" class="debug-timer"></div>
    <div id="right-widget-debug-timer" class="debug-timer"></div>

    <script type="module">
        import { initializeApp } from './main.js';
        import { enableDragResize } from './dragResize.js';

        // Load widget HTML content
        const widgetContainer = document.getElementById('widget-container');
        const widgetFiles = ['datetime-widget.html', 'main-widget.html', 'chores-widget.html', 'right-widget.html'];

        Promise.all(widgetFiles.map(widget => 
            fetch(widget)
                .then(response => response.text())
                .then(html => {
                    widgetContainer.insertAdjacentHTML('beforeend', html);
                })
        ))
        .then(() => {
            console.log('All widgets loaded');
            // Load all scripts
            return Promise.all([
                loadScript('eventSystem.js'),
                loadScript('dateTime.js'),
                loadScript('weather.js'),
                loadScript('calendar.js'),
                loadScript('iosAlbum.js'),
                loadScript('contentCycling.js'),
                loadScript('config.js'),
                loadScript('chores.js'),
                loadScript('choreToggle.js'),
                loadScript('ui.js'),
                loadScript('rss.js')
            ]);
        })
        .then(() => {
            console.log('All scripts loaded');
            initializeApp();
            enableDragResize();
        })
        .catch(error => console.error('Error loading widgets or scripts:', error));

        // Add a catch-all error handler
        window.addEventListener('error', function(event) {
            console.error('Unhandled error:', event.error);
        });

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }
    </script>
</body>
</html>
