<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../src/styles/main.css" type="text/css">
    <link rel="stylesheet" href="../src/styles/components/datetime.css" type="text/css">
    <link rel="stylesheet" href="../src/styles/components/weather.css" type="text/css">
    <link rel="stylesheet" href="../src/styles/components/calendar.css" type="text/css">
    <link rel="stylesheet" href="../src/styles/components/chores.css" type="text/css">
    <link rel="stylesheet" href="../src/styles/components/rightWidget.css" type="text/css">
    <link rel="stylesheet" href="../src/styles/components/popup.css" type="text/css">
    <title>Smart Dashboard</title>
</head>
<body>
    <div id="background"></div>
    <div id="dashboard">
        <div id="version-number">v0.1.8</div>
        <div id="widget-container"></div>
    </div>
    <div id="chore-popup" class="popup">
        <div class="popup-content">
            <h2>Configure Chore Timing</h2>
            <p>Chore: <span id="chore-name"></span></p>
            <div class="day-selection">
                <label><input type="checkbox" class="day-checkbox" value="mon"><span>Mon</span></label>
                <label><input type="checkbox" class="day-checkbox" value="tue"><span>Tue</span></label>
                <label><input type="checkbox" class="day-checkbox" value="wed"><span>Wed</span></label>
                <label><input type="checkbox" class="day-checkbox" value="thu"><span>Thu</span></label>
                <label><input type="checkbox" class="day-checkbox" value="fri"><span>Fri</span></label>
                <label><input type="checkbox" class="day-checkbox" value="sat"><span>Sat</span></label>
                <label><input type="checkbox" class="day-checkbox" value="sun"><span>Sun</span></label>
                <button id="select-all-days-button">All Days</button>
            </div>
            <div class="time-selection">
                <label for="chore-time">Time 1:</label>
                <input type="time" id="chore-time">
            </div>
            <div class="time-selection">
                <label for="chore-time2">Time 2 (Optional):</label>
                <input type="time" id="chore-time2">
            </div>
            <button id="save-chore-button">Save</button>
            <button id="close-popup-button">Close</button>
        </div>
    </div>
    
    <!-- Debug toggle button -->
    <div id="debug-toggle" class="debug-control">
        <button id="debug-button">Debug</button>
    </div>

    <!-- Lock toggle button -->
    <div id="lock-toggle" class="lock-control">
        <button id="lock-button">Lock</button>
    </div>

    <!-- Swipe toggle button -->
    <div id="swipe-toggle" class="swipe-control">
        <button id="swipe-button">Swipe</button>
    </div>

    <!-- Debug timer displays -->
    <div id="main-widget-debug-timer" class="debug-timer"></div>
    <div id="right-widget-debug-timer" class="debug-timer"></div>

    <script type="module">
        import { initializeApp } from '../src/scripts/main.js';
        import { enableDragResize } from '../src/scripts/dragResize.js';
        import { toggleDebugging } from '../src/scripts/contentCycling.js';
        import { initializeUI } from '../src/scripts/ui.js';

        // Load widget HTML content
        const widgetContainer = document.getElementById('widget-container');
        const widgetFiles = [
            '../src/components/datetime-widget.html', 
            '../src/components/main-widget.html', 
            '../src/components/chores-widget.html', 
            '../src/components/right-widget.html'
        ];

        Promise.all(widgetFiles.map(widget => 
            fetch(widget)
                .then(response => response.text())
                .then(html => {
                    widgetContainer.insertAdjacentHTML('beforeend', html);
                })
        ))
        .then(() => {
            console.log('All widgets loaded');
            // Load all scripts
            return Promise.all([
                loadScript('../src/scripts/eventSystem.js'),
                loadScript('../src/scripts/dateTime.js'),
                loadScript('../src/scripts/weather.js'),
                loadScript('../src/scripts/calendar.js'),
                loadScript('../src/scripts/iosAlbum.js'),
                loadScript('../src/scripts/contentCycling.js'),
                loadScript('../src/scripts/config.js'),
                loadScript('../src/scripts/chores.js'),
                loadScript('../src/scripts/choreToggle.js'),
                loadScript('../src/scripts/rss.js')
            ]);
        })
        .then(() => {
            console.log('All scripts loaded');
            initializeApp();
            enableDragResize();
            initializeUI();
            document.getElementById('debug-button').addEventListener('click', toggleDebugging);
        })
        .catch(error => console.error('Error loading widgets or scripts:', error));

        // Add a catch-all error handler
        window.addEventListener('error', function(event) {
            console.error('Unhandled error:', event.error);
        });

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }
    </script>
</body>
</html>
